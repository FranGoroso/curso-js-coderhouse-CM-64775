let preguntasFaciles = [
    {
        pregunta: "¿Qué es un array en programación?",
        opciones: [
            "a) Un tipo de bucle", 
            "b) Una función que realiza cálculos", 
            "c) Una estructura de datos que almacena elementos en una secuencia", 
            "d) Un tipo de variable que almacena cadenas de texto"
        ],
        respuestaCorrecta: "c"
    },
    {
        pregunta: "¿Cuál es el resultado de 5 * 2 en JavaScript?",
        opciones: [
            "a) 10", 
            "b) 52", 
            "c) Error", 
            "d) 7"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué operador se utiliza para asignar un valor a una variable en JavaScript?",
        opciones: [
            "a) ==", 
            "b) =", 
            "c) ===", 
            "d) =>"
        ],
        respuestaCorrecta: "b"
    },
    {
        pregunta: "¿Qué significa CSS?",
        opciones: [
            "a) Cascading Style Sheets", 
            "b) Computer Styling System", 
            "c) Code Style Sheets", 
            "d) Cascading Simple Sheets"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué método se utiliza para agregar un elemento al final de un array en JavaScript?",
        opciones: [
            "a) push()", 
            "b) pop()", 
            "c) unshift()", 
            "d) shift()"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué función se utiliza para mostrar un mensaje en la consola del navegador?",
        opciones: [
            "a) print()", 
            "b) console.log()", 
            "c) alert()", 
            "d) log()"
        ],
        respuestaCorrecta: "b"
    },
    {
        pregunta: "¿Qué palabra clave se utiliza para declarar una constante en JavaScript?",
        opciones: [
            "a) var", 
            "b) let", 
            "c) const", 
            "d) constant"
        ],
        respuestaCorrecta: "c"
    },
    {
        pregunta: "¿Qué tipo de datos se utiliza para almacenar un valor verdadero o falso?",
        opciones: [
            "a) Number", 
            "b) String", 
            "c) Boolean", 
            "d) Array"
        ],
        respuestaCorrecta: "c"
    },
    {
        pregunta: "¿Qué método se utiliza para convertir una cadena de texto a un número entero en JavaScript?",
        opciones: [
            "a) parseInt()", 
            "b) toString()", 
            "c) toInteger()", 
            "d) Number()"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Cuál de los siguientes operadores se utiliza para concatenar dos cadenas de texto?",
        opciones: [
            "a) +", 
            "b) &", 
            "c) .", 
            "d) %"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué estructura de control se utiliza para tomar decisiones en JavaScript?",
        opciones: [
            "a) for loop", 
            "b) if-else", 
            "c) switch-case", 
            "d) while loop"
        ],
        respuestaCorrecta: "b"
    },
    {
        pregunta: "¿Qué palabra clave se utiliza para detener la ejecución de un bucle en JavaScript?",
        opciones: [
            "a) break", 
            "b) stop", 
            "c) halt", 
            "d) exit"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué función se utiliza para obtener la longitud de una cadena de texto en JavaScript?",
        opciones: [
            "a) length()", 
            "b) size()", 
            "c) count()", 
            "d) length"
        ],
        respuestaCorrecta: "d"
    },
    {
        pregunta: "¿Qué método se utiliza para eliminar el último elemento de un array en JavaScript?",
        opciones: [
            "a) pop()", 
            "b) push()", 
            "c) remove()", 
            "d) shift()"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué significa NaN en JavaScript?",
        opciones: [
            "a) Not a Number", 
            "b) Not a Null", 
            "c) No Action Needed", 
            "d) Null and Number"
        ],
        respuestaCorrecta: "a"
    },
];

let preguntasIntermedias = [
    {
        pregunta: "¿Cuál es el propósito de un bucle while en JavaScript?",
        opciones: [
            "a) Ejecutar un bloque de código una vez", 
            "b) Ejecutar un bloque de código mientras una condición es verdadera", 
            "c) Definir una función", 
            "d) Ordenar un array"
        ],
        respuestaCorrecta: "b"
    },
    {
        pregunta: "¿Qué hace el método Array.prototype.map() en JavaScript?",
        opciones: [
            "a) Modifica el array original", 
            "b) Crea un nuevo array con los resultados de aplicar una función a cada elemento del array original", 
            "c) Filtra los elementos de un array según una condición", 
            "d) Encuentra un elemento en un array"
        ],
        respuestaCorrecta: "b"
    },
    {
        pregunta: "¿Qué significa la palabra clave this en JavaScript?",
        opciones: [
            "a) Hace referencia al objeto global", 
            "b) Hace referencia al objeto que está llamando al método", 
            "c) Hace referencia a una variable local", 
            "d) No tiene ningún significado especial"
        ],
        respuestaCorrecta: "b"
    },
    {
        pregunta: "¿Qué método se utiliza para agregar uno o más elementos al inicio de un array en JavaScript?",
        opciones: [
            "a) push()", 
            "b) pop()", 
            "c) unshift()", 
            "d) shift()"
        ],
        respuestaCorrecta: "c"
    },
    {
        pregunta: "¿Qué función se utiliza para convertir un objeto en una cadena JSON en JavaScript?",
        opciones: [
            "a) JSON.stringify()", 
            "b) JSON.parse()", 
            "c) toString()", 
            "d) stringify()"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué método se utiliza para ordenar los elementos de un array en JavaScript?",
        opciones: [
            "a) sort()", 
            "b) order()", 
            "c) arrange()", 
            "d) map()"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Cuál es la diferencia entre == y === en JavaScript?",
        opciones: [
            "a) == compara solo valores, === compara valores y tipos", 
            "b) == compara valores y tipos, === compara solo valores", 
            "c) Ambos son iguales, no hay diferencia", 
            "d) == compara solo cadenas, === compara solo números"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué es una función anónima en JavaScript?",
        opciones: [
            "a) Una función sin nombre", 
            "b) Una función que no se puede llamar", 
            "c) Una función que se ejecuta automáticamente", 
            "d) Una función que devuelve un valor nulo"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué hace el operador typeof en JavaScript?",
        opciones: [
            "a) Verifica si una variable está definida", 
            "b) Devuelve el tipo de dato de una variable", 
            "c) Convierte una variable a un tipo específico", 
            "d) Crea una nueva variable"
        ],
        respuestaCorrecta: "b"
    },
    {
        pregunta: "¿Qué es el objeto Math en JavaScript?",
        opciones: [
            "a) Un objeto para realizar operaciones matemáticas", 
            "b) Un objeto para manipular cadenas de texto", 
            "c) Un objeto para manipular arrays", 
            "d) Un objeto para trabajar con fechas"
        ],
        respuestaCorrecta: "a"
    },
];

let preguntasDificiles = [
    {
        pregunta: "¿Qué es el event loop en JavaScript?",
        opciones: [
            "a) Un bucle que permite que JavaScript maneje tareas asíncronas", 
            "b) Un método para recorrer arrays", 
            "c) Una función para detener la ejecución del código", 
            "d) Una estructura de datos para manejar eventos"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué es una closure en JavaScript?",
        opciones: [
            "a) Una función que recuerda el entorno en el que fue creada", 
            "b) Un objeto que encapsula datos y métodos", 
            "c) Un tipo de error en el código", 
            "d) Una estructura de control para iterar sobre arrays"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué hace el método bind() en JavaScript?",
        opciones: [
            "a) Asocia una función a un objeto específico", 
            "b) Detiene la ejecución de una función", 
            "c) Copia una función en otra variable", 
            "d) Llama a una función con un objeto específico"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué es la herencia prototipal en JavaScript?",
        opciones: [
            "a) Un modelo de herencia en el que los objetos pueden heredar propiedades y métodos directamente de otros objetos", 
            "b) Un modelo de herencia basado en clases", 
            "c) Un patrón de diseño para organizar código", 
            "d) Una función que permite crear nuevos objetos"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué método se utiliza para crear una promesa en JavaScript?",
        opciones: [
            "a) new Promise()", 
            "b) createPromise()", 
            "c) makePromise()", 
            "d) promise()"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué es una función de orden superior en JavaScript?",
        opciones: [
            "a) Una función que puede tomar otras funciones como argumentos o devolver una función como resultado", 
            "b) Una función que siempre devuelve un valor", 
            "c) Una función que solo se puede ejecutar una vez", 
            "d) Una función que es llamada automáticamente al cargar la página"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué hace el método reduce() en JavaScript?",
        opciones: [
            "a) Aplica una función a cada elemento de un array para reducirlo a un único valor", 
            "b) Ordena los elementos de un array en orden descendente", 
            "c) Filtra los elementos de un array según una condición", 
            "d) Encuentra el primer elemento que cumple una condición"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué es el ámbito léxico en JavaScript?",
        opciones: [
            "a) El alcance de una variable está determinado por su ubicación dentro del código fuente", 
            "b) El alcance de una variable se determina durante la ejecución del programa", 
            "c) Una variable solo puede ser accedida dentro de la función en la que se define", 
            "d) Una variable global puede ser accedida desde cualquier parte del código"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué es el operador spread (...) en JavaScript?",
        opciones: [
            "a) Un operador que expande un array o un objeto en sus elementos individuales", 
            "b) Un operador que combina dos arrays", 
            "c) Un operador que crea una copia superficial de un objeto", 
            "d) Un operador que intercambia los elementos de un array"
        ],
        respuestaCorrecta: "a"
    },
    {
        pregunta: "¿Qué hace el método finally() en una promesa de JavaScript?",
        opciones: [
            "a) Se ejecuta siempre al final de una promesa, independientemente de si se resolvió o rechazó", 
            "b) Resuelve una promesa", 
            "c) Rechaza una promesa", 
            "d) Cancela una promesa"
        ],
        respuestaCorrecta: "a"
    },
];

//FUNCIONALIDAD NECESARIA: Guardar en el local storage las respuestas del usuario 

//PROXIMAMENTE: Crear un JSON con todas las preguntas o asociarlo a una API ya existente
//               Despues mejorar toda la parte visual del programa y añadirle graficos de barras o algo asi


document.getElementById("btnComenzar").addEventListener("click", darComienzo);
let respuestasCorrectas = 0;

function darComienzo(){ 
    let nivelSeleccionado = seleccionarDificultad();
    let preguntasFiltradas = filtrarPreguntasPorDificultad(nivelSeleccionado);
    mostrarPreguntas(preguntasFiltradas);
    
}

document.getElementById("mostrarResultadoBtn").addEventListener("click", function() {
    let nivelSeleccionado = seleccionarDificultad();
    let preguntasFiltradas = filtrarPreguntasPorDificultad(nivelSeleccionado);
    respuestasCorrectas = validarRespuestas(preguntasFiltradas);
    mostrarResultado(respuestasCorrectas, preguntasFiltradas.length);
});




function seleccionarDificultad(){
    return document.getElementById("nivel").value; //Tomo el valor seleccionado por el usuario en el DOM (Nivel de dificultad)
};




function filtrarPreguntasPorDificultad(nvlDif) { 
    // Filtra las preguntas según la dificultad seleccionada por el usuario
    switch(nvlDif) {
        case "facil":
            return preguntasFaciles;
        case "intermedio":
            return preguntasIntermedias;
        case "dificil":
            return preguntasDificiles;
        default:
            return preguntasFaciles; // Valor por defecto si no se selecciona un nivel válido
    }
};




function crearContenedorPreguntas(preguntas){
    let contenedorPreguntas = document.createElement("div"); // Crea un div contenedor para mostrar las preguntas en el DOM

    preguntas.forEach((e, i) => { 
        let textoPregunta = document.createElement("p"); // Crea un elemento en el DOM el cual se guarda en la variable
        textoPregunta.textContent = `${i + 1}. ${e.pregunta}`; // Modifico el el contenido de texto que esta en la variable del DOM (i es el indice {el cual muestra el numero de la pregunta y e.pregunta es la pregunta como tal que al estar en el bucle, las recorre todas})
        contenedorPreguntas.appendChild(textoPregunta); // Aqui agrego en cada iteracion, el texto de la oregunta al contenedor que va a tener las preguntas y opciones mas adelante

        let contenedorOpciones = crearContenedorOpciones(e.opciones, i); // Creo un contenedor para las opciones (en cada iteracion e.opciones, va a recorrer todas, y la i seria como el identificador el cual se asocia a cada pregunta, esto tiene que ver con la funcion de crearContenedorOpciones)
        contenedorPreguntas.appendChild(contenedorOpciones); // Cumplo el objetivo y agrego las opciones al contenedor principal que tambien tiene las preguntas, ahora "contenedorPreguntas" tiene todo
    });

    return contenedorPreguntas; // Retorna el contenedor de preguntas oon las opciones tambien
};




function crearContenedorOpciones(opciones, index){
    let contenedorOpciones = document.createElement("div"); 

    let respuestaGuardada = localStorage.getItem(`respuesta_pregunta_${index}`); //Recuperando la respuesta que estaba guardada en el local storage

    opciones.forEach(opcion => {
        let opcionesElemento = document.createElement("label"); //Creo un label en el DOM para poder asocioarlo a cada pregunta
        let inputOpcion = document.createElement("input"); // Esto es para seleccionar opciones
        inputOpcion.type = "radio"; // Para que la opcion sea redonda 
        inputOpcion.name = `pregunta${index}`; // Asociando las preguntas a las opciones para que tengan UNA SOLA OPCION
        inputOpcion.value = opcion; // Se agrega el valor que quiero tener en la opcion seleccionada por el usuario, para validar que realmente sea correcto

        if (opcion === respuestaGuardada){
            inputOpcion.checked = true; //Si la opcion conicide con la respuestaGuardada, se volvera a cargar la opcion con la opcion "marcada", (eso se logra con el .checked)
        };
        
        opcionesElemento.appendChild(inputOpcion);
        opcionesElemento.appendChild(document.createTextNode(opcion));
        contenedorOpciones.appendChild(opcionesElemento);
        contenedorOpciones.appendChild(document.createElement("br"))
    });

    return contenedorOpciones;
};


function mostrarPreguntas(preguntas){
    let contenedorPreguntas = crearContenedorPreguntas(preguntas);
    let contenedorPrincipal = document.getElementById("preguntas");
    contenedorPrincipal.innerHTML = ""; // Esto limpia las preguntas anteriores
    contenedorPrincipal.appendChild(contenedorPreguntas);
};




function validarRespuestas(preguntas) {
    let correctas = 0;

    preguntas.forEach((pregunta, index) => {
        let seleccionada = document.querySelector(`input[name="pregunta${index}"]:checked`);
        
        if(seleccionada) { // Esto verifica si el usuario selecciono una opcion para la pregunta actual (True si selecciono, y si no selecciono seria False)
            localStorage.setItem(`respuesta_pregunta_${index}`/*EJ: respuesta_pregunta_2*/, seleccionada.value);
            
            if(seleccionada.value[0] === pregunta.respuestaCorrecta){
                correctas++
            }; //seleccionada.value[0], es para que me devuelva el primer carácter del string, y si cada opcion empieza con una letra (Ej: a) Es un bucle que itera por cada... ), entonces tomará la letra "a", asociada a la opcion de la pregunta
        }           /*Cabe destacar que tambien podria corregir la sintaxis de las preguntas del array que las contien y directamente respuestaCorrecta, puede ser la respuesta completa en vez de la letra, entonces no haria falta el uso indice*/ 
    });

    return correctas;
}


function mostrarResultado(respuestasCorrectas, cantidadTotalPreguntas) {
    let contenedorResultados = document.createElement("div");
    let textoResultados = document.createElement("p");

    let porcentaje = (respuestasCorrectas / cantidadTotalPreguntas) * 100;
    let estado = "";
    if(porcentaje >= 60){
        estado = "aprobado"
    }else{
        estado = "desaprobado"
    };

    textoResultados.textContent = `Has respondido correctamente ${respuestasCorrectas} de ${cantidadTotalPreguntas} preguntas (${porcentaje.toFixed(2)}%). Estás ${estado}.`;

    contenedorResultados.appendChild(textoResultados);

    let contenedorPrincipal = document.getElementById("resultado");
    contenedorPrincipal.innerHTML = "";
    contenedorPrincipal.appendChild(contenedorResultados);
}

// Vincular el botón a la función mostrarResultado cuando se hace clic
document.getElementById("mostrarResultadoBtn").addEventListener("click", function() {
    mostrarResultado(respuestasCorrectas, cantidadTotalPreguntas);
});
